<!doctype html>
<html>
<head>
    <title>Encryption/decryption RSA AES</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font: 13px Helvetica, Arial; }
        textarea{
            width: 400px;
            height: 300px;
        }
    </style>
</head>
<body>

<div>
    <h2>Server public key</h2>
<textarea id="server_public" >
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnPQ6+vqnIwpYLNmM0DvP
jWYoaZHV6rW4HcofqyjUO8rzQSEmfgT+quTzPsNcnAqHVC7IGafomu8Y82wX6JPK
YZHn+st8ZoehILgZSBM6y1QIVXdBnQct+R3/o1Gc7TMMYVjk+UrFT7PHou7AwmTM
TRiS/ZvSRVoSXs3AxMCUn1V83FP68yKMDq2I82WOESoAWqGuYmsIxk2EXVaGBtjM
wRIs2EzWz8ITfmOczl+QAH31SDCSIJxWbkEHopzHJnEW99p7I3P1cr17JEKGhWO1
nx2Wq6X4OC6Y5MaB64MzspDTND5gzwPNTibcw3s/59o+FV22drhCwylUxuWUhakP
LQIDAQAB
-----END PUBLIC KEY-----
</textarea>
</div>

<div>
    <h2>Client public key</h2>
<textarea id="client_public">
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAj3esh+8vIdSIb44d0yGB
WDwOgQDAUqbZbSUkS7ho9OP3ptopmqw20Bc37RfKAqEjqY88kzl011BWw/MB/u0w
5f5ps8VH/lqFE/WeUWbuYZGi7w5dcGrUmiDYOPyz4B7GlYFUwkkiaduIFIRwO36/
+Vw9oC4cXpyxjJfFgVWLyhvCwuTOSy8E+LgZVNreIGeK0x1Cg3H3n2tR9I/ZmdWp
oVqQS3w7AxcSwz8g+KekLEVwFjuoWEu2z0KHrgLoyI4ksDJI6pCI+PjhQydcLhST
vSJCSBe+qleaecxrLR3P8Xs5HLYu3Mc4Sssdu+/3bBbUKufnxaTX6Rkp+SfxwGyK
rwIDAQAB
-----END PUBLIC KEY-----
</textarea>
</div>

<div>
    <h2>Client private key</h2>
<textarea id="client_private">
-----BEGIN PRIVATE KEY-----
MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQCPd6yH7y8h1Ihv
jh3TIYFYPA6BAMBSptltJSRLuGj04/em2imarDbQFzftF8oCoSOpjzyTOXTXUFbD
8wH+7TDl/mmzxUf+WoUT9Z5RZu5hkaLvDl1watSaINg4/LPgHsaVgVTCSSJp24gU
hHA7fr/5XD2gLhxenLGMl8WBVYvKG8LC5M5LLwT4uBlU2t4gZ4rTHUKDcfefa1H0
j9mZ1amhWpBLfDsDFxLDPyD4p6QsRXAWO6hYS7bPQoeuAujIjiSwMkjqkIj4+OFD
J1wuFJO9IkJIF76qV5p5zGstHc/xezkcti7cxzhKyx277/dsFtQq5+fFpNfpGSn5
J/HAbIqvAgMBAAECggEASEcZY65rh1akmdb2TZzOph4zjGhNfBZU6bjRjVhNgDqt
VKEKXsMuJi3cXhUjD6oQ5makNOO4apUt8TAnLEBg5y4CILBeMdV2v/R5GzeJFxyh
AmCxUGZxz2iGpkchc+LtVvq+MddYgA46g2Opiz+zBbSj02QHpN66UENSHHN1po8K
y9yNcXBxta3fwRS0g/ARLxbGnkKBhOxraV6UwOcjRFDAO6aC25KyP59JAM0SxmnO
G1sIDwiYz8lfM1D5ydffWAKGCU7ZBkrVDM4yumSpqEwCMTTcnEjTbQ8ZDYSz1vZZ
haVGzcgUrPtB9SGOgt9GbVrr0CMrSkEH9QVoPuVlGQKBgQDqYk+N92CZZ22pQ8te
kz1wyyqcJWrltMHKMLxzbDFzcJoL219XmGAcPG7fk4Qc6zq8E0f/+dfrbNyCUBEf
Zxal0t70QJWhCTxdQnLCTqLn1sdMr5POkVjEnF04kwacqolmNVC50H6sW2ilzzQn
CzjwoTzfGWoyLWU5YZXCfXXEXQKBgQCcst57Qyz/Sa6SaFjHzVQeDc9TqtVo9niu
H6DUTnCgM57mvBeYsedet359NJ3ET0vQT5RRAkPRBqgezxNb3OAa/dhV1glvArHr
7UPsAH6Yp98taYFHomqivR8CXq9AxV2EcAwIHBYJR21U6g/7XGUEExz2tQ+AzrBd
IFVo9CDaewKBgAMLIcNTKgLz792ZzsM8oDidusDqT3gKH9YTSe8pwX6hQK7Uu2k0
xlK3ii0HClkhyNJ2YaH2SZJ6CGb8ySwiN44Rrel4CTldGFaRrVHOmZjvFglt4jp1
crSi3ycD6bsRD9Wu7YxsI6jzSumURjYXlDazsUmoV9Os+TqEhOBQpr3VAoGAHBRx
ieUfyx+JCPNp9WP2DuyqmnOiioygU5OXXnQv+oVFlFNgZxx6OZ7oK8eh/eu3yjx4
d4vQW0S2G88/yNZr0mpqufcA+cOh3oVGBqSQCwsKEzk00YFpWoBJbkNJZHH5sCHk
BhACYudJ0E2hT4nfEDvclNkdThe7wvRoWcZlnMECgYBDSLnDeyduLhvctgcJUU9F
QdqFYAWjzXFfJItUGWAGFC7Lpn8PVcc7u6hH1oFJlohi39T2gYrKB5PmYN9/52/r
u8ThbAvTm+yqMmsDNkBkohfx25p3NLsV0r46mpRXuraQTFXcYrc1mW+BkoteY06S
Oe6lSHTplzRc0QPTat5+mQ==
-----END PRIVATE KEY-----
</textarea>
</div>

<script src="/socket.io/socket.io.js"></script>
<script src="/js/converter-wrapper.js"></script>
<script src="/js/encoding.js"></script>
<script src="/js/encoding-indexes.js"></script>
<script src="/js/converter-wrapper.js"></script>
<script src="/js/rsa-wrapper.js"></script>
<script src="/js/aes-wrapper.js"></script>

<script>

    var socket = io();

    socket.on('rsa server encrypted message', function (msg) {

        console.log('rsa server encrypted message');
        console.log(msg);

        rsaWrapper.privateDecrypt(document.getElementById('client_private').value, msg).then(function (decrypted) {
            console.log(decrypted);
        });

        rsaWrapper.publicEncrypt(document.getElementById('server_public').value, 'Приветосик').then(function (encrypted) {
            console.log('RSA encrypted base64 message from client', '\n', encrypted);
            socket.emit('rsa client encrypted message', encrypted);
        });
    });

    socket.on('aes server encrypted message', function (msg) {

        aesWrapper.importPublicKey(msg.key).then(function (key) {
            aesWrapper.decryptMessage(key, msg.message).then(function (dec) {
                aesWrapper.encryptMessage(key, 'some message').then(function (encrypted) {
                    socket.emit('aes client encrypted message', encrypted)
                });
            });
        });

    });
</script>
</body>
</html>